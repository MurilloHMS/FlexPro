@page "/abastecimentos"
@using Microsoft.AspNetCore.Authorization
@using FlexPro.Data
@using FlexPro.Models
@using Microsoft.EntityFrameworkCore
@inject IDialogService DialogService
@inject ApplicationDbContext _Context

@attribute [Authorize]

<PageTitle>Abastecimentos</PageTitle>

<MudText Typo="Typo.h5">Abastecimentos</MudText>
<br><br>

<MudFileUpload T="IBrowserFile" Accept=".xlsx, .xls" MaximumFileCount="100" FilesChanged="uploadFile">
    <ActivatorContent>
        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   StartIcon="@Icons.Material.Filled.CloudUpload">
            Importar dados Abastecimentos
        </MudButton>
    </ActivatorContent>
</MudFileUpload>


@if (_files != null)
{
    <MudList T="string">
        @foreach (var file in _files)
        {
            <MudListItem Icon="@Icons.Material.Filled.AttachFile">
                @file.Name <code>@file.Size bytes</code>
            </MudListItem>
        }
    </MudList>
}

<br><br>

<MudDataGrid Items="@_abastecimentos" T="Abastecimento" Hover="true" Bordered="true" Striped="true" Dense="true" SortMode="SortMode.Multiple" Filterable="true">
    <ToolBarContent>
        <MudText Typo="Typo.h6">Dados abastecimentos</MudText>
        <MudSpacer/>
        <MudTextField Placeholder="Buscar" Adornment="Adornment.Start" Immediate="true" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"/>
    </ToolBarContent>
    <Columns>
        <PropertyColumn Property="x => x.NomeDoMotorista" Title="Motorista" Sortable="true" Filterable="true"/>
        <PropertyColumn Property="x => x.Placa" Title="Placa" Sortable="true" Filterable="true"/>
        <PropertyColumn Property="x => x.Departamento" Title="Departamento" Sortable="true" Filterable="true"/>
        <PropertyColumn Property="x => x.Uf" Title="UF" Sortable="true" Filterable="true"/>
        <PropertyColumn Property="x => x.Litros" Title="Litros" Sortable="true" Filterable="true"/>
        <PropertyColumn Property="x => x.ValorTotalTransacao" Title="Total Gasto" Sortable="true" Filterable="true"/>
    </Columns>
</MudDataGrid>

@code {
    private IEnumerable<Abastecimento> _abastecimentos;
    private IList<IBrowserFile> _files = new List<IBrowserFile>();

    private void uploadFile(IBrowserFile file)
    {
        _files.Add(file);
    }

    protected override async void OnInitialized()
    {
        try
        {
            _abastecimentos =  new List<Abastecimento>();
        }
        catch (Exception e)
        {
            throw;
        }
    }

}